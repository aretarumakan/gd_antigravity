# Google Drive Managed MCP セットアップガイド

このガイドでは、Google Cloud のマネージド型 MCP サーバーを使用して Google Drive 連携を行う手順を説明します。
ローカルに認証キーを保存する必要がないため、よりセキュアかつ簡潔に利用できます。

---

## 🛡️ マネージド型のメリット
- **キーレス連携**: 個別の `gcp-oauth.keys.json` ファイルの管理や、Gitへの誤コミットを心配する必要がありません。
- **Google公式管理**: インフラの保守がGoogle側で行われるため、安定性が高いです。
- **一元的な認証**: `gcloud` コマンドによる一度のログインで、複数のマネージドサービスを利用可能になります。

---

## 🚨 重要事項
データの取り扱い監視やAI学習への利用に関する重要な警告については、[データの取り扱いに関する警告 (重要)](../警告.md) を必ず確認してください。

---

## ⚠️ リスクと注意点

マネージド型 MCP は便利ですが、以下の点に注意して利用してください。

### 1. コストについて
- **Google Cloud Run**: バックグラウンドで Cloud Run などのリソースが使用される場合、無料枠を超えると課金が発生する可能性があります。個人の学習用であれば通常は無料枠内に収まりますが、大量のデータを処理する場合などは請求アラートを設定することを推奨します。
- **API クオータ**: Google Drive API には利用制限（クオータ）があります。短時間に大量のリクエスト（検索や読み込み）を行うと、一時的にアクセスが制限される場合があります。

### 2. 権限の範囲
- **ADC (Application Default Credentials)**: `gcloud auth application-default login` で認証すると、ローカル環境のアプリケーションに対し、あなたのGoogleアカウントとしての広範なアクセス権限（ドライブの読み書きなど）が付与されます。

  **⚠️ 具体的なリスク例:**
  - **マルウェアやウイルス**: もし先生のパソコンがマルウェアに感染してしまった場合、そのマルウェアもこの「広範な権限」を利用できる状態になります。結果として、ドライブ内の機密情報（生徒の成績、会議録など）が外部に送信されたり、改ざんされたりする恐れがあります。
  - **信頼できないアプリの実行**: インターネットからダウンロードした出所不明のプログラムを実行した際、そのプログラムがバックグラウンドで認証情報を悪用してドライブにアクセスする可能性があります。
- **サービスの可用性**: Google Cloud のシステム障害やメンテナンス時には機能が利用できなくなる可能性があります。

  **対策**:
  - セキュリティソフトを常に最新の状態にする。
  - 信頼できる開発元以外のソフトウェアを同じPCで安易に実行しない。
  - 定期的に `gcloud auth revoke` を実行して、不要な時は認証を解除する。

### 3. 環境依存
- **インターネット接続**: マネージド型サーバーはクラウド上のリソースと通信するため、常時インターネット接続が必要です。オフライン環境では動作しません。
- **サービスの可用性**: Google Cloud のシステム障害やメンテナンス時には機能が利用できなくなる可能性があります。

---

## 📋 セットアップ手順

### 1. Google Cloud CLI (`gcloud`) のインストールと確認
お手元のマシンに `gcloud` がインストールされているか確認してください。
```bash
gcloud --version
```

### 2. アプリケーションのデフォルト認証 (ADC) の有効化
ターミナルで以下のコマンドを実行します。
```bash
gcloud auth application-default login
```
ブラウザが開くので、Google Drive へのアクセスを許可するアカウントでログインしてください。これにより、`npx @google-cloud/cloud-run-mcp` があなたの権限を使用してドライブにアクセスできるようになります。

### 3. Antigravity の設定
`~/.gemini/antigravity/mcp_config.json` を開き、以下の内容を追加します。

```json
"google-drive": {
  "command": "npx",
  "args": [
    "-y",
    "@google-cloud/cloud-run-mcp",
    "--server-id",
    "google-drive"
  ]
}
```

---

## ✅ 動作確認

1. **Antigravity を再起動**してください。
2. AIエージェントに以下のように依頼してテストします。
   - 「最近のGoogleドライブのファイルをリストアップして」
   - 「Googleドライブから『特定のプロジェクト名』が含まれるファイルを探して」

---

## 💡 トラブルシューティング
- **認証エラー**: 再度 `gcloud auth application-default login` を実行して、正しいアカウントで認証されているか確認してください。
- **権限エラー**: Google Cloud Console で、使用しているプロジェクトの「Google Drive API」が有効になっているか確認してください。

